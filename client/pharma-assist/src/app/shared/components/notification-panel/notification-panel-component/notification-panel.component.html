<div class="notification-panel" [class.open]="isOpen()">
  <!-- Panel Header -->
  <div class="panel-header">
    <h3>{{ 'notifications.title' | translate }}</h3>
    <div class="header-actions">
      @if (unreadCount() > 0) {
        <button class="btn-text" (click)="markAllRead()">
          {{ 'notifications.markAllRead' | translate }}
        </button>
      }
      <button class="btn-icon" (click)="close()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="panel-tabs">
    <button
      class="tab"
      [class.active]="activeTab() === 'all'"
      (click)="setTab('all')">
      {{ 'notifications.tabs.all' | translate }}
      @if (totalCount() > 0) {
        <span class="tab-badge">{{ totalCount() }}</span>
      }
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'unread'"
      (click)="setTab('unread')">
      {{ 'notifications.tabs.unread' | translate }}
      @if (unreadCount() > 0) {
        <span class="tab-badge urgent">{{ unreadCount() }}</span>
      }
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'alerts'"
      (click)="setTab('alerts')">
      {{ 'notifications.tabs.alerts' | translate }}
      @if (alertsCount() > 0) {
        <span class="tab-badge warning">{{ alertsCount() }}</span>
      }
    </button>
  </div>

  <!-- Content -->
  <div class="panel-content">
    @if (loading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'common.loading' | translate }}</p>
      </div>
    } @else if (filteredNotifications().length === 0) {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>
        </svg>
        <h4>{{ 'notifications.empty.title' | translate }}</h4>
        <p>{{ 'notifications.empty.message' | translate }}</p>
      </div>
    } @else {
      <div class="notification-list">
        @for (notification of filteredNotifications(); track notification.id) {
          <div
            class="notification-item"
            [class.unread]="!notification.read"
            [class]="'notification-' + notification.type"
            (click)="handleClick(notification)">

            <div class="notification-icon">
              @switch (notification.type) {
                @case ('success') {
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                }
                @case ('danger') {
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                }
                @case ('warning') {
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                  </svg>
                }
                @default {
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                  </svg>
                }
              }
            </div>

            <div class="notification-content">
              <h5 class="notification-title">{{ notification.title }}</h5>
              <p class="notification-message">{{ notification.message }}</p>
              <span class="notification-time">{{ formatTime(notification.timestamp) }}</span>
            </div>

            <button class="btn-dismiss" (click)="dismiss(notification.id, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        }
      </div>
    }
  </div>

  <!-- Footer -->
  @if (filteredNotifications().length > 0) {
    <div class="panel-footer">
      <button class="btn-text danger" (click)="clearAll()">
        {{ 'notifications.clearAll' | translate }}
      </button>
    </div>
  }
</div>

<!-- Backdrop -->
@if (isOpen()) {
  <div class="backdrop" (click)="close()"></div>
}
