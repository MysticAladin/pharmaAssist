<div class="sales-report">
  <div class="breadcrumb">
    <a routerLink="/reports">{{ 'reports.title' | translate }}</a>
    <span class="separator">/</span>
    <span>{{ 'reports.sales.title' | translate }}</span>
  </div>

  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">{{ 'reports.sales.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'reports.sales.subtitle' | translate }}</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        {{ 'reports.actions.export' | translate }}
      </button>
      <button class="btn-primary" (click)="generateReport()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
        {{ 'reports.actions.generate' | translate }}
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-bar filter-row">
    <div class="date-range">
      <label>{{ 'reports.filters.dateRange' | translate }}</label>
      <div class="date-inputs">
        <input type="text" inputmode="numeric" placeholder="dd.MM.yyyy" [ngModel]="startDateText" (ngModelChange)="onStartDateChange($event)" class="date-input">
        <span class="date-separator">-</span>
        <input type="text" inputmode="numeric" placeholder="dd.MM.yyyy" [ngModel]="endDateText" (ngModelChange)="onEndDateChange($event)" class="date-input">
      </div>
    </div>
    <div class="filter-block filter-right">
      <label>{{ 'reports.filters.predefined' | translate }}</label>
      <div class="quick-ranges">
        <button class="range-btn" [class.active]="selectedRange === '7d'" (click)="setRange('7d')">{{ 'reports.filters.last7Days' | translate }}</button>
        <button class="range-btn" [class.active]="selectedRange === '30d'" (click)="setRange('30d')">{{ 'reports.filters.last30Days' | translate }}</button>
        <button class="range-btn" [class.active]="selectedRange === 'month'" (click)="setRange('month')">{{ 'reports.filters.thisMonth' | translate }}</button>
        <button class="range-btn" [class.active]="selectedRange === 'year'" (click)="setRange('year')">{{ 'reports.filters.thisYear' | translate }}</button>
      </div>
    </div>
  </div>

  <!-- Summary Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon revenue"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
      <div class="stat-content">
        <span class="stat-label">{{ 'reports.sales.revenue' | translate }}</span>
        <span class="stat-value">{{ totalRevenue() | number:'1.2-2' }} KM</span>
        <span class="stat-change" [class.positive]="revenueGrowth() >= 0" [class.negative]="revenueGrowth() < 0">
          {{ revenueGrowth() >= 0 ? '+' : '' }}{{ revenueGrowth() | number:'1.0-1' }}%
        </span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orders"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg></div>
      <div class="stat-content">
        <span class="stat-label">{{ 'reports.sales.orders' | translate }}</span>
        <span class="stat-value">{{ totalOrders() }}</span>
        <span class="stat-change" [class.positive]="ordersGrowth() >= 0" [class.negative]="ordersGrowth() < 0">
          {{ ordersGrowth() >= 0 ? '+' : '' }}{{ ordersGrowth() | number:'1.0-1' }}%
        </span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon avg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div>
      <div class="stat-content">
        <span class="stat-label">{{ 'reports.sales.avgOrderValue' | translate }}</span>
        <span class="stat-value">{{ avgOrderValue() | number:'1.2-2' }} KM</span>
        <span class="stat-change negative"> 2.1%</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon growth"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div>
      <div class="stat-content">
        <span class="stat-label">{{ 'reports.sales.growth' | translate }}</span>
        <span class="stat-value">+15.3%</span>
        <span class="stat-change positive">vs last period</span>
      </div>
    </div>
  </div>

  <!-- Charts Placeholder -->
  <div class="charts-section">
    <div class="chart-card large">
      <h3 class="chart-title">{{ 'reports.sales.dailySales' | translate }}</h3>
      <div class="chart-placeholder">
        <div class="bar-chart">
          @for (day of dailySales(); track $index) {
            <div class="bar-container">
              <div class="bar" [style.height.%]="(day.value / maxDailySale()) * 100"></div>
              <span class="bar-label">{{ day.label }}</span>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Top Products & Customers -->
  <div class="lists-section">
    <div class="list-card">
      <h3 class="list-title">{{ 'reports.sales.topProducts' | translate }}</h3>
      <div class="list-items">
        @for (product of topProducts(); track product.name) {
          <div class="list-item">
            <div class="item-info">
              <span class="item-rank">{{ $index + 1 }}</span>
              <span class="item-name">{{ product.name }}</span>
            </div>
            <div class="item-stats">
              <span class="item-value">{{ product.value | number:'1.2-2' }} KM</span>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="product.percentage"></div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
    <div class="list-card">
      <h3 class="list-title">{{ 'reports.sales.topCustomers' | translate }}</h3>
      <div class="list-items">
        @for (customer of topCustomers(); track customer.name) {
          <div class="list-item">
            <div class="item-info">
              <span class="item-rank">{{ $index + 1 }}</span>
              <span class="item-name">{{ customer.name }}</span>
            </div>
            <div class="item-stats">
              <span class="item-value">{{ customer.value | number:'1.2-2' }} KM</span>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="customer.percentage"></div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>
