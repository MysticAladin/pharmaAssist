<div class="dashboard">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">{{ 'dashboard.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'dashboard.welcome' | translate }}, {{ user()?.firstName }}!</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-icon btn-ghost" (click)="refreshData()" [disabled]="loading()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" [class.spinning]="loading()">
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/>
        </svg>
      </button>
      <button class="btn btn-primary" (click)="createNewOrder()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"/><path d="M12 5v14"/>
        </svg>
        {{ 'dashboard.newOrder' | translate }}
      </button>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button class="quick-action-btn" (click)="navigateTo('/orders/new')">
      <div class="action-icon action-icon-blue">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
      </div>
      <span>{{ 'dashboard.actions.newOrder' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="navigateTo('/products/new')">
      <div class="action-icon action-icon-green">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
      </div>
      <span>{{ 'dashboard.actions.addProduct' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="navigateTo('/customers')">
      <div class="action-icon action-icon-purple">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      </div>
      <span>{{ 'dashboard.actions.customers' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="navigateTo('/inventory')">
      <div class="action-icon action-icon-orange">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
      </div>
      <span>{{ 'dashboard.actions.lowStock' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="navigateTo('/reports/expiring-products')">
      <div class="action-icon action-icon-yellow">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
      </div>
      <span>{{ 'dashboard.actions.expiringProducts' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="navigateTo('/reports')">
      <div class="action-icon action-icon-teal">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
      </div>
      <span>{{ 'dashboard.actions.reports' | translate }}</span>
    </button>
    <button class="quick-action-btn" (click)="openBarcodeScanner()">
      <div class="action-icon action-icon-indigo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 5v14"/><path d="M21 5v14"/><path d="M6 5v14"/><path d="M18 5v14"/><path d="M10 5v14"/><path d="M14 5v14"/></svg>
      </div>
      <span>{{ 'dashboard.actions.scanBarcode' | translate }}</span>
    </button>
  </div>

  <!-- Barcode Scanner Modal -->
  @if (showBarcodeScanner()) {
    <app-barcode-scanner
      (closed)="showBarcodeScanner.set(false)"
      (productSelected)="onBarcodeProductSelected($event)">
    </app-barcode-scanner>
  }

  <!-- Quick Stats -->
  <div class="stats-grid">
    <!-- Today's Orders -->
    <div class="stat-card" [class.loading]="loading()">
      <div class="stat-icon stat-icon-blue">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/>
          <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ dashboardData()?.stats?.orders?.todayCount ?? 0 }}</span>
        <span class="stat-label">{{ 'dashboard.stats.todayOrders' | translate }}</span>
      </div>
      @if (dashboardData()?.stats?.orders?.changePercent; as change) {
        <div class="stat-change" [class.positive]="change >= 0" [class.negative]="change < 0">
          @if (change >= 0) {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/>
            </svg>
          }
          {{ change >= 0 ? '+' : '' }}{{ change }}%
        </div>
      }
    </div>

    <!-- Daily Revenue -->
    <div class="stat-card" [class.loading]="loading()">
      <div class="stat-icon stat-icon-green">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(dashboardData()?.stats?.orders?.todayRevenue ?? 0) }}</span>
        <span class="stat-label">{{ 'dashboard.stats.dailyRevenue' | translate }}</span>
      </div>
      <div class="stat-change positive">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>
        </svg>
        +8%
      </div>
    </div>

    <!-- Low Stock Count -->
    <div class="stat-card" [class.loading]="loading()" (click)="navigateTo('/inventory')">
      <div class="stat-icon stat-icon-orange">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/>
          <path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ dashboardData()?.stats?.inventory?.lowStockCount ?? 0 }}</span>
        <span class="stat-label">{{ 'dashboard.stats.lowStockItems' | translate }}</span>
      </div>
      <a class="stat-link">{{ 'common.view' | translate }}</a>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="dashboard-grid">
    <!-- Recent Orders -->
    <div class="dashboard-card orders-card">
      <div class="card-header">
        <h3 class="card-title">{{ 'dashboard.recentOrders' | translate }}</h3>
        <a routerLink="/orders" class="view-all-link">{{ 'common.viewAll' | translate }}</a>
      </div>

      @if (loading()) {
        <div class="orders-list">
          @for (i of [1, 2, 3]; track i) {
            <div class="order-item skeleton">
              <div class="skeleton-content"></div>
            </div>
          }
        </div>
      } @else if (recentOrders().length === 0) {
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
          </svg>
          <p>{{ 'dashboard.noRecentOrders' | translate }}</p>
          <button class="btn btn-primary btn-sm" (click)="navigateTo('/orders/new')">
            {{ 'dashboard.createFirstOrder' | translate }}
          </button>
        </div>
      } @else {
        <div class="orders-list">
          @for (order of recentOrders(); track order.id) {
            <div class="order-item" (click)="navigateTo('/orders/' + order.id)">
              <div class="order-info">
                <span class="order-id">#{{ order.orderNumber || order.id }}</span>
                <span class="order-customer">{{ order.customerName || 'Unknown Customer' }}</span>
              </div>
              <div class="order-meta">
                <span class="order-amount">{{ formatCurrency(order.totalAmount) }}</span>
                <span class="order-status" [class]="'status-' + getStatusClass(order.status)">
                  {{ getStatusLabel(order.status) | translate }}
                </span>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Alerts Section -->
    <div class="dashboard-card alerts-card">
      <div class="card-header">
        <h3 class="card-title">{{ 'dashboard.alerts' | translate }}</h3>
        @if (alerts().length > 0) {
          <span class="alert-count">{{ alerts().length }}</span>
        }
      </div>

      @if (loading()) {
        <div class="alerts-list">
          @for (i of [1, 2]; track i) {
            <div class="alert-item skeleton">
              <div class="skeleton-content"></div>
            </div>
          }
        </div>
      } @else if (alerts().length === 0) {
        <div class="empty-state small">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <p>{{ 'dashboard.noAlerts' | translate }}</p>
        </div>
      } @else {
        <div class="alerts-list">
          @for (alert of alerts(); track alert.id) {
            <div class="alert-item" [class]="'alert-' + alert.type" (click)="alert.link && navigateTo(alert.link)">
              @if (alert.type === 'danger') {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              }
              <div class="alert-content">
                <span class="alert-title">{{ alert.title }}</span>
                <span class="alert-desc">{{ alert.description }}</span>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Activity Feed -->
    <div class="dashboard-card activity-card">
      <app-activity-feed />
    </div>

    <!-- Advanced Analytics (Feature Gated) -->
    <ng-container *hasFeature="advancedAnalyticsKey; else upgradePrompt">
      <div class="dashboard-card analytics-card full-width">
        <div class="card-header">
          <h3 class="card-title">{{ 'dashboard.advancedAnalytics' | translate }}</h3>
        </div>
        <div class="analytics-placeholder">
          <p>{{ 'dashboard.analyticsComingSoon' | translate }}</p>
        </div>
      </div>
    </ng-container>

    <ng-template #upgradePrompt>
      <div class="dashboard-card upgrade-prompt-card">
        <div class="upgrade-content">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="upgrade-icon">
            <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <h4>{{ 'dashboard.advancedAnalytics' | translate }}</h4>
          <p>{{ 'dashboard.upgradeMessage' | translate }}</p>
          <a routerLink="/upgrade" [queryParams]="{feature: 'advanced_analytics'}" class="btn btn-outline">
            {{ 'dashboard.upgradePlan' | translate }}
          </a>
        </div>
      </div>
    </ng-template>
  </div>
</div>
