<div class="page-container">
  <!-- Page Header -->
  <div class="page-header">
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a routerLink="/dashboard">{{ 'common.home' | translate }}</a>
      <span class="separator">/</span>
      <a routerLink="/inventory">{{ 'inventory.title' | translate }}</a>
      <span class="separator">/</span>
      <span class="current">{{ 'inventory.adjustments' | translate }}</span>
    </nav>
  </div>

  <!-- Title and Actions -->
  <div class="title-row">
    <h1>{{ 'inventory.adjustmentHistory' | translate }}</h1>
    <a routerLink="/inventory/adjustments/new" class="btn btn-primary">
      <i class="icon-plus"></i>
      {{ 'inventory.newAdjustment' | translate }}
    </a>
  </div>

  <!-- Filters -->
  <div class="filters-card filters-section">
    <div class="filter-row">
      <div class="filter-block">
        <label for="typeFilter">{{ 'inventory.typeLabel' | translate }}</label>
        <select id="typeFilter" class="filter-select" [(ngModel)]="selectedType" (change)="applyFilters()">
          <option [ngValue]="null">{{ 'inventory.allTypes' | translate }}</option>
          @for (type of adjustmentTypes; track type) {
            <option [value]="type">{{ getTypeLabel(type) | translate }}</option>
          }
        </select>
      </div>

      <div class="filter-block">
        <label for="startDate">{{ 'common.from' | translate }}</label>
        <div class="date-input-wrapper">
          <input
            id="startDate"
            class="date-input date-filter"
            type="text"
            inputmode="numeric"
            placeholder="dd.MM.yyyy"
            [ngModel]="startDateText"
            (ngModelChange)="onStartDateTextChange($event)"
            (blur)="onStartDateBlur()"
          />
          <input
            type="date"
            class="hidden-date-picker"
            [value]="startDate"
            (change)="onNativeStartDateChange($event)"
            #startDatePicker
          />
          <button type="button" class="calendar-icon" (click)="startDatePicker.showPicker()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
          </button>
        </div>
      </div>

      <div class="filter-block">
        <label for="endDate">{{ 'common.to' | translate }}</label>
        <div class="date-input-wrapper">
          <input
            id="endDate"
            class="date-input date-filter"
            type="text"
            inputmode="numeric"
            placeholder="dd.MM.yyyy"
            [ngModel]="endDateText"
            (ngModelChange)="onEndDateTextChange($event)"
            (blur)="onEndDateBlur()"
          />
          <input
            type="date"
            class="hidden-date-picker"
            [value]="endDate"
            (change)="onNativeEndDateChange($event)"
            #endDatePicker
          />
          <button type="button" class="calendar-icon" (click)="endDatePicker.showPicker()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
          </button>
        </div>
      </div>

      @if (hasFilters()) {
        <button type="button" class="btn-text filter-right" (click)="clearFilters()">
          <i class="icon-x"></i>
          {{ 'common.clearFilters' | translate }}
        </button>
      }
    </div>
  </div>

  <!-- Adjustments Table -->
  <div class="table-section">
    @if (loading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>{{ 'common.loading' | translate }}</p>
      </div>
    } @else if (adjustments().length === 0) {
      <app-empty-state
        [title]="'inventory.noAdjustments' | translate"
        [description]="'inventory.noAdjustmentsDescription' | translate"
        icon="icon-package"
      />
    } @else {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'inventory.date' | translate }}</th>
              <th>{{ 'inventory.product' | translate }}</th>
              <th>{{ 'inventory.typeLabel' | translate }}</th>
              <th class="text-right">{{ 'inventory.quantity' | translate }}</th>
              <th>{{ 'inventory.reason' | translate }}</th>
              <th>{{ 'inventory.adjustedBy' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            @for (adjustment of adjustments(); track adjustment.id) {
              <tr>
                <td class="date">{{ adjustment.adjustedAt | europeanDate }}</td>
                <td>
                  <div class="product-info">
                    <span class="product-name">{{ adjustment.productName }}</span>
                    <span class="sku">{{ adjustment.productSku }}</span>
                  </div>
                </td>
                <td>
                  <app-status-badge
                    [label]="getTypeLabel(adjustment.adjustmentType)"
                    [variant]="getTypeColor(adjustment.adjustmentType)"
                    [shouldTranslate]="true"
                  />
                </td>
                <td class="text-right">
                  <span
                    class="quantity-change"
                    [class.positive]="isAdditionType(adjustment.adjustmentType)"
                    [class.negative]="!isAdditionType(adjustment.adjustmentType)"
                  >
                    {{ isAdditionType(adjustment.adjustmentType) ? '+' : '-' }}{{ adjustment.quantity }}
                  </span>
                </td>
                <td>
                  <span class="reason">{{ adjustment.reason }}</span>
                  @if (adjustment.notes) {
                    <i class="icon-info notes" [title]="adjustment.notes"></i>
                  }
                </td>
                <td>{{ adjustment.adjustedBy }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <app-pagination
        [page]="currentPage()"
        [size]="pageSize()"
        [totalItems]="totalItems()"
        (pageChange)="onPageChange($event)"
      />
    }
  </div>
</div>
