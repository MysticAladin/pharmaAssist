<div class="inventory-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>{{ 'inventory.title' | translate }}</h1>
        <p class="subtitle">{{ 'inventory.subtitle' | translate }}</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" routerLink="warehouses">
          <i class="icon-building"></i>
          {{ 'inventory.warehouses.title' | translate }}
        </button>
        <button class="btn btn-secondary" routerLink="adjustments">
          <i class="icon-sliders"></i>
          {{ 'inventory.adjustments' | translate }}
        </button>
        <button class="btn btn-secondary" routerLink="transfers">
          <i class="icon-truck"></i>
          {{ 'inventory.transfers' | translate }}
        </button>
        <button class="btn btn-primary" routerLink="adjustments/new">
          <i class="icon-plus"></i>
          {{ 'inventory.newAdjustment' | translate }}
        </button>
      </div>
    </div>
  </header>

  <!-- Quick Stats -->
  <section class="stats-section">
    <div class="stat-card warning">
      <div class="stat-icon">
        <i class="icon-alert-triangle"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ lowStockCount() }}</span>
        <span class="stat-label">{{ 'inventory.lowStock' | translate }}</span>
      </div>
    </div>
    <div class="stat-card info">
      <div class="stat-icon">
        <i class="icon-package"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ totalProducts() }}</span>
        <span class="stat-label">{{ 'inventory.totalProducts' | translate }}</span>
      </div>
    </div>
  </section>

  <!-- Filters -->
  <section class="filters-section">
    <div class="filter-row">
      <app-search-input
        [placeholder]="'inventory.searchPlaceholder' | translate"
        (searchChange)="onSearch($event)">
      </app-search-input>

      <select class="form-select" [(ngModel)]="selectedLocationId" (ngModelChange)="onLocationChange()">
        @for (location of locations(); track location.id) {
          <option [value]="location.id">{{ location.name }}</option>
        }
      </select>

      <div class="filter-toggles">
        <label class="toggle-label">
          <input type="checkbox" [(ngModel)]="showLowStockOnly" (change)="applyFilters()">
          <span>{{ 'inventory.lowStockOnly' | translate }}</span>
        </label>
      </div>
    </div>
  </section>

  <!-- Stock Table -->
  <section class="table-section">
    @if (loading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <span>{{ 'common.loading' | translate }}</span>
      </div>
    } @else if (stockLevels().length === 0) {
      <app-empty-state
        icon="package"
        [title]="'inventory.noProducts' | translate"
        [description]="'inventory.noProductsDescription' | translate">
      </app-empty-state>
    } @else {
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>{{ 'inventory.product' | translate }}</th>
              <th>{{ 'inventory.sku' | translate }}</th>
              <th>{{ 'inventory.packageSize' | translate }}</th>
              <th>{{ 'inventory.location' | translate }}</th>
              <th>{{ 'inventory.expiryDate' | translate }}</th>
              <th class="text-right">{{ 'inventory.available' | translate }}</th>
              <th class="text-right">{{ 'inventory.reserved' | translate }}</th>
              <th class="text-right">{{ 'inventory.total' | translate }}</th>
              <th class="text-center">{{ 'inventory.status' | translate }}</th>
              <th class="text-center actions-cell">{{ 'common.actions' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            @for (stock of stockLevels(); track stock.productId) {
              <tr [class.low-stock]="stock.isLowStock">
                <td>
                  <div class="product-info">
                    <span class="product-name">{{ stock.productName }}</span>
                  </div>
                </td>
                <td>
                  <code class="sku">{{ stock.productSku }}</code>
                </td>
                <td>{{ stock.packageSize || '-' }}</td>
                <td>{{ stock.warehouseName }}</td>
                <td>
                  @if (stock.earliestExpiryDate) {
                    <span [class.text-warning]="isExpiringSoon(stock.earliestExpiryDate)">{{ stock.earliestExpiryDate | date:'dd.MM.yyyy' }}</span>
                  } @else {
                    <span class="text-muted">-</span>
                  }
                </td>
                <td class="text-right">
                  <span [class.text-danger]="stock.quantityAvailable < stock.reorderPoint">
                    {{ stock.quantityAvailable }}
                  </span>
                </td>
                <td class="text-right">{{ stock.quantityReserved }}</td>
                <td class="text-right">
                  <strong>{{ stock.quantityOnHand }}</strong>
                </td>
                <td class="text-center">
                  <app-status-badge
                    [variant]="getStockStatus(stock).variant"
                    [label]="getStockStatus(stock).label | translate">
                  </app-status-badge>
                </td>
                <td class="text-center actions-cell">
                  <div class="action-buttons">
                    <button
                      class="btn btn-icon btn-sm"
                      [title]="'inventory.viewDetails' | translate"
                      (click)="viewProductDetails(stock.productId)">
                      <i class="icon-eye"></i>
                    </button>
                    <button
                      class="btn btn-icon btn-sm"
                      [title]="'inventory.adjust' | translate"
                      (click)="adjustStock(stock)">
                      <i class="icon-edit"></i>
                    </button>
                    <button
                      class="btn btn-icon btn-sm"
                      [title]="'inventory.history' | translate"
                      (click)="viewHistory(stock.productId)">
                      <i class="icon-list"></i>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <app-pagination
        [page]="currentPage()"
        [size]="pageSize()"
        [totalItems]="totalItems()"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    }
  </section>
</div>
